{# projects/templates/projects/project_detail.html #}
{% extends "dashboard/base.html" %}

{% block content %}
<div class="container mt-4">

 <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="fw-bold mb-0">{{ project.name }}</h3>

    <div>
        <a href="{% url 'project_edit' project.id %}" class="btn btn-sm btn-outline-light">Edit</a>
        <a href="{% url 'project_list' %}" class="btn btn-sm btn-secondary">Back to Projects</a>
    </div>
</div>

<!-- Project Meta -->
<div class="card dashboard-card p-3 mb-4">
    <p class="mb-1"><strong>Status:</strong> {{ project.get_status_display }}</p>
    <p class="mb-1"><strong>Stakeholders:</strong> {{ project.stakeholders|default:"—" }}</p>
    <p class="mb-1">
        <strong>Dates:</strong>
        {% if project.start_date %}{{ project.start_date }}{% else %}?{% endif %}
        —
        {% if project.end_date %}{{ project.end_date }}{% else %}?{% endif %}
    </p>
    <p class="mt-2 text-muted">{{ project.description }}</p>
</div>


  <!-- Project Messages -->
  <div class="row g-4">
    <div class="col-md-6">
      <div class="card dashboard-card p-3 h-100">
        <h5 class="fw-bold mb-3">Project Messages</h5>

        {% for m in messages %}
          <div class="border rounded p-2 mb-2">
            <div class="d-flex justify-content-between">
              <strong>{{ m.subject }}</strong>
              <small class="text-muted">{{ m.created_at|date:"Y-m-d H:i" }}</small>
            </div>
            <p class="mb-2">{{ m.body }}</p>
            <div class="d-flex justify-content-end">
              <a href="{% url 'project_message_archive' m.id %}"
                 class="btn btn-sm btn-outline-warning">Archive</a>
            </div>
          </div>
        {% empty %}
          <p class="text-muted">No messages yet for this project.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Compose Message -->
    <div class="col-md-6">
      <div class="card dashboard-card p-3 h-100">
        <h5 class="fw-bold mb-3">Add Message / Update</h5>
        <form method="POST">
          {% csrf_token %}
          {{ message_form.as_p }}
          <button class="btn btn-success mt-2">Post Message</button>
        </form>
      </div>
    </div>
  </div>

</div>
{% endblock %}
